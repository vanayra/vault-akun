<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultra Secure Family Vault</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

<style>
body{
font-family:Segoe UI;
margin:0;
background:#f4f6f9;
}

#loginPage{
height:100vh;
display:flex;
justify-content:center;
align-items:center;
}

.card{
background:white;
padding:35px;
border-radius:15px;
box-shadow:0 10px 25px rgba(0,0,0,0.1);
width:320px;
text-align:center;
}

input,select{
width:100%;
padding:10px;
margin-top:10px;
border-radius:8px;
border:1px solid #ccc;
}

button{
margin-top:12px;
padding:10px;
width:100%;
border:none;
border-radius:8px;
background:#4CAF50;
color:white;
cursor:pointer;
}

#mainPage{
display:none;
padding:20px;
}

.account-card{
background:white;
padding:15px;
margin-top:10px;
border-radius:10px;
box-shadow:0 5px 10px rgba(0,0,0,0.08);
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginPage">
<div class="card">
<h2>üîê Family Vault</h2>
<input type="password" id="masterPass" placeholder="Master Password">
<button onclick="login()">Masuk</button>
<button onclick="biometricLogin()">üîì Login Fingerprint</button>
<p id="error" style="color:red"></p>
</div>
</div>

<!-- MAIN -->
<div id="mainPage">

<h2>üìÅ Vault Akun</h2>

<button onclick="enableBiometric()">Aktifkan Biometric Unlock</button>

<input type="text" id="searchBox" placeholder="Cari akun..." onkeyup="tampilkanAkun()">

<div id="accountList"></div>

<h3>Tambah Akun</h3>

<select id="kategori">
<option>Email</option>
<option>Social Media</option>
<option>Bank</option>
<option>Lainnya</option>
</select>

<input type="text" id="nama" placeholder="Platform">
<input type="text" id="username" placeholder="Username">
<input type="text" id="password" placeholder="Password">

<button onclick="generatePassword()">üé≤ Generate Password</button>
<button onclick="tambahAkun()">Tambah Akun</button>

<h3>Backup</h3>
<button onclick="exportBackup()">Export Backup</button>

</div>

<script>

let masterPassword="";
let akun = JSON.parse(localStorage.getItem("akun")) || [];
let idleTimer;

/* ===== Encryption ===== */

function encrypt(text){
return CryptoJS.AES.encrypt(text, masterPassword).toString();
}

function decrypt(text){
return CryptoJS.AES.decrypt(text, masterPassword).toString(CryptoJS.enc.Utf8);
}

/* ===== LOGIN ===== */

function login(){

masterPassword = masterPass.value;

if(masterPassword.length < 6){
error.innerText="Minimal 6 karakter";
return;
}

sessionStorage.setItem("vaultSession", masterPassword);

loginPage.style.display="none";
mainPage.style.display="block";

resetIdleTimer();
tampilkanAkun();
}

/* ===== BIOMETRIC LOGIN ===== */

function biometricLogin(){

let storedKey = localStorage.getItem("biometricKey");

if(!storedKey){
alert("Biometric belum diaktifkan");
return;
}

masterPassword = storedKey;

loginPage.style.display="none";
mainPage.style.display="block";

resetIdleTimer();
tampilkanAkun();
}

/* ===== ENABLE BIOMETRIC ===== */

function enableBiometric(){
localStorage.setItem("biometricKey", masterPassword);
alert("Biometric berhasil diaktifkan di device ini");
}

/* ===== AUTO LOCK ===== */

function resetIdleTimer(){
clearTimeout(idleTimer);

idleTimer = setTimeout(()=>{
alert("Vault terkunci karena idle");
location.reload();
},120000);
}

document.onmousemove = resetIdleTimer;
document.onkeydown = resetIdleTimer;

/* ===== TAMBAH AKUN ===== */

function tambahAkun(){

akun.push({
kategori:kategori.value,
nama:nama.value,
username:username.value,
password:encrypt(password.value)
});

localStorage.setItem("akun", JSON.stringify(akun));

tampilkanAkun();

nama.value="";
username.value="";
password.value="";
}

/* ===== TAMPILKAN ===== */

function tampilkanAkun(){

let keyword = searchBox.value.toLowerCase();
accountList.innerHTML="";

akun.forEach((a,i)=>{

if(a.nama.toLowerCase().includes(keyword)){

accountList.innerHTML+=`
<div class="account-card">
<b>${a.nama}</b> (${a.kategori})<br>
User : ${a.username}<br>

Password : 
<span id="pass${i}">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span><br>

<button onclick="showPass(${i})">Show</button>
<button onclick="copyPass(${i})">Copy</button>
<button onclick="hapusAkun(${i})">Hapus</button>
</div>`;
}
});
}

/* ===== SHOW PASSWORD ===== */

function showPass(i){

let span = document.getElementById("pass"+i);

if(span.innerText==="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"){
span.innerText = decrypt(akun[i].password);
}else{
span.innerText="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
}
}

/* ===== COPY PASSWORD ===== */

function copyPass(i){

let pass = decrypt(akun[i].password);
navigator.clipboard.writeText(pass);
alert("Password disalin");
}

/* ===== PASSWORD GENERATOR ===== */

function generatePassword(){

let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*";
let pass="";

for(let i=0;i<14;i++){
pass += chars[Math.floor(Math.random()*chars.length)];
}

password.value = pass;
}

/* ===== HAPUS ===== */

function hapusAkun(i){
akun.splice(i,1);
localStorage.setItem("akun", JSON.stringify(akun));
tampilkanAkun();
}

/* ===== BACKUP ===== */

function exportBackup(){

let blob = new Blob([JSON.stringify(akun)],{type:"application/json"});
let a = document.createElement("a");

a.href = URL.createObjectURL(blob);
a.download = "vaultBackup.json";
a.click();
}

</script>
</body>
</html>
